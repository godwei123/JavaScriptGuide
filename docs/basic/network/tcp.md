# TCP 和 UDP

## TCP 特点

## UDP 特点

## TCP 三次握手

![三次握手](../../public/aHR0cDovL2ltZy5.png)

### 为什么不是两次？

> 无法确认客户端的接收能力。

如果首先客户端发送了 SYN 报文，但是滞留在网络中，TCP 以为丢包了，然后重传，两次握手建立了连接。

等到客户端关闭连接了。但是之后这个包如果到达了服务端，那么服务端接收到了，然后发送相应的数据表，就建立了链接，但是此时客户端已经关闭连接了，所以带来了链接资源的浪费。

### 为什么不是四次？

四次以上都可以，只不过 三次就够了

## TCP 四次挥手

![aHR0cDovL2ltZy5ibG](../../public/aHR0cDovL2ltZy5ibG.png)

## TCP 和 UDP 对比

## TCP 可靠传输

## TCP 流量控制

## TCP 拥塞控制

## TCP 是怎么判断丢包的？

## TCP 的重传机制

由于 TCP 的下层网络（网络层）可能出现丢失、重复或失序的情况，TCP 协议提供可靠数据传输服务。为保证数据传输的正确性，TCP
会重传其认为已丢失（包括报文中的比特错误）的包。TCP 使用两套独立的机制来完成重传，一是基于时间，二是基于确认信息。

TCP 在发送一个数据之后，就开启一个定时器，若是在这个时间内没有收到发送数据的 ACK
确认报文，则对该报文进行重传，在达到一定次数还没有成功时放弃并发送一个复位信号。

## TCP 流量控制、拥塞控制

一般来说，流量控制就是为了让发送方发送数据的速度不要太快，要让接收方来得及接收。TCP 采用大小可变的滑动窗口
进行流量控制，窗口大小的单位是字节。这里说的窗口大小其实就是每次传输的数据大小。

- 当一个连接建立时，连接的每一端分配一个缓冲区来保存输入的数据，并将缓冲区的大小发送给另一端。
- 当数据到达时，接收方发送确认，其中包含了自己剩余的缓冲区大小。（剩余的缓冲区空间的大小被称为窗口，指出窗口大小的通知称为窗口通告

  。接收方在发送的每一确认中都含有一个窗口通告。）

- 如果接收方应用程序读数据的速度能够与数据到达的速度一样快，接收方将在每一确认中发送一个正的窗口通告。
- 如果发送方操作的速度快于接收方，接收到的数据最终将充满接收方的缓冲区，导致接收方通告一个零窗口

  。发送方收到一个零窗口通告时，必须停止发送，直到接收方重新通告一个正的窗口。

TCP 的拥塞控制机制主要是以下四种机制：

- 慢启动（慢开始）
- 拥塞避免
- 快速重传
- 快速恢复

## tcp/udp 区别

## udp 不稳定怎么解决

- 增加系统发送或接收缓冲区大小
- 增加应答机制，处理完一个包后，在继续发包
- 控制报文大小
