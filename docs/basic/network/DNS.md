# DNS

::: tip
DNS（Domain Name System，域名系统），因特网上作为域名和 IP 地址相互映射的一个分布式数据库，能够使人更方便地访问互联网，而不用去记住能够被机器直接读取的 IP 数串。
:::

DNS 使用 TCP 和 UDP 端口 53。DNS 查询消息有两种格式，一种是标准查询，一种是反向查询。标准查询是最常用的查询方式，它使用域名来查询对应的 IP 地址。反向查询则是用 IP 地址来查询对应的域名。

## DNS 解析过程

DNS 解析过程分为以下几个步骤：

1. 浏览器缓存：浏览器会缓存 DNS 记录一段时间，不同浏览器缓存时间不一样，一般都是几分钟到几小时不等。
2. 系统缓存：如果在浏览器缓存中没有找到需要的记录，浏览器会搜索操作系统缓存，操作系统缓存也有相应的缓存时间。
3. 路由器缓存：如果在操作系统缓存中没有找到需要的记录，浏览器会搜索路由器缓存。
4. ISP DNS 缓存：如果在路由器缓存中没有找到需要的记录，浏览器会搜索 ISP DNS 缓存，ISP DNS 服务器也有相应的缓存时间。
5. 递归搜索：如果在 ISP DNS 缓存中没有找到需要的记录，浏览器会向根域名服务器发起请求，根域名服务器返回给浏览器一个所查询域名服务器的地址。
6. 迭代搜索：浏览器向查询域名服务器发起请求，查询域名服务器返回给浏览器一个所查询域名的 IP 地址。
7. 解析完成：浏览器得到域名对应的 IP 地址，浏览器会把域名和对应的 IP 地址缓存起来，下次再访问这个域名时就不需要解析了。
8. 浏览器发起 HTTP 请求：浏览器发起 HTTP 请求，请求报文中包含了域名，操作系统会先检查自己的 hosts 文件是否有这个域名映射关系，如果有，就先返回 hosts 文件中配置的 IP 地址，如果没有，就会再次发起 DNS 解析。
9. DNS 服务器解析域名：操作系统会向 DNS 服务器发起请求，这时操作系统会检查自己的 DNS 缓存，如果缓存中有，就会返回缓存中的 IP 地址，如果没有，就会向 DNS 服务器发起请求。
10. DNS 服务器返回 IP 地址：如果 DNS 服务器有映射关系，就会将 IP 地址返回给操作系统，操作系统会将 IP 地址缓存起来，并回应给浏览器。
